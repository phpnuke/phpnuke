var MYBB_SMILIES={},Thread={},smileyMapdes2=dropdownsmiliesdes.concat(dropdownsmiliesdesmore),smileyMapurl2=dropdownsmiliesurl.concat(dropdownsmiliesurlmore),isWebkit="WebkitAppearance"in document.documentElement.style,i;for(i in smileyMapurl2)MYBB_SMILIES[smileyMapurl2[i].split("/").pop()]=smileyMapdes2[i];function isOrContains(a,d){for(;a;){if(a===d)return!0;a=a.parentNode}return!1}
function elementContainsSelection(a){var d;if(window.getSelection){if(d=window.getSelection(),0<d.rangeCount){for(var f=0;f<d.rangeCount;++f)if(!isOrContains(d.getRangeAt(f).commonAncestorContainer,a))return!1;return!0}}else if((d=document.selection)&&"Control"!=d.type)return isOrContains(d.createRange().parentElement(),a);return!1}
function getposition(){var a,d="sel_"+(new Date).getTime()+"_"+Math.random().toString().substr(2),f={},b;document.selection&&document.selection.createRange?(b=document.selection.createRange().duplicate(),b.collapse(!1),b.pasteHTML('\x3cspan id\x3d"'+d+'" style\x3d"position: relative;"\x3e\x26#xfeff;\x3c/span\x3e'),a=document.getElementById(d)):window.getSelection&&(a=window.getSelection(),a.getRangeAt?b=a.getRangeAt(0).cloneRange():(b=document.createRange(),b.setStart(a.anchorNode,a.anchorOffset),
b.setEnd(a.focusNode,a.focusOffset),b.collapsed!==a.isCollapsed&&(b.setStart(a.focusNode,a.focusOffset),b.setEnd(a.anchorNode,a.anchorOffset))),b.collapse(!1),a=document.createElement("span"),a.id=d,a.appendChild(document.createTextNode("﻿")),b.insertNode(a));if(a){var d=a,c=b=0;do b+=d.offsetLeft,c+=d.offsetTop;while(d=d.offsetParent);f.left=b;f.top=c;a.parentNode.removeChild(a);return f}}var noalready=1,beforeselect=null;
function quick_quote(a){function d(a){a=$(a.target);a.hasClass("postbody")||(a=a.parents(".postbody"));if(a&&a.length){var b=window.getSelection().getRangeAt(0);$.trim(window.getSelection().toString())&&beforeselect!=b?(beforeselect=b,elementContainsSelection(a.find(".content")[0])?(a=window.getSelection().getRangeAt(0).getBoundingClientRect(),$elm=$(".rin-qc").show(),$elm.css({top:window.scrollY+a.top+a.height+6+"px",left:getposition().left-$elm.outerWidth()+13+"px"})):$(".rin-qc").hide()):$(".rin-qc").hide()}else $(".rin-qc").hide()}
noalready&&($("body").append("\x3cdiv class\x3d'rin-qc' style\x3d'display: none;'\x3e\x3cspan\x3e"+RinEditor.Quickquote+"\x3c/span\x3e\x3c/div\x3e"),$(".rin-qcdp").each(function(){var a=$(this).attr("name");$(this).siblings(".content").attr("id","pid_"+a)}),noalready=0);$(".fa-reply, .reply-icon").length&&$("#qr_postform").length&&($("#pid_"+a+"").on("mouseup touchend",d),$('body:not("#pid_'+a+'")').click(function(a){$.trim(window.getSelection().toString())||$(".rin-qc").hide()}),$(".rin-qc").click(function(d){d.preventDefault();
setTimeout(function(){if(elementContainsSelection(document.getElementById("pid_"+a+""))){Thread.quickQuote(a);$(".rin-qc").hide();var b=window.getSelection?window.getSelection():document.selection;b&&(b.removeAllRanges?b.removeAllRanges():b.empty&&b.empty())}else $(".rin-qc").hide()},200)}))}
Thread.quickQuote=function(a){var d=postid.indexOf(""+a+"");if(isWebkit||window.getSelection().toString().trim())userSelection=window.getSelection().getRangeAt(0).cloneContents(),a="[quote\x3d"+postuser[d]+" post_id\x3d"+a+" time\x3d"+postdate[d]+" user_id\x3d"+postuid[d]+"]\n",a+=Thread.domToBB(userSelection,MYBB_SMILIES),a+="\n[/quote]\n",delete userSelection,Thread.updateMessageBox(a)};
Thread.updateMessageBox=function(a){MyBBEditor.insertText(a,"","","","quote");setTimeout(function(){offset=$("#qr_postform").offset().top-60;setTimeout(function(){$("html, body").animate({scrollTop:offset},700)},200)},100)};Thread.RGBtoHex=function(a,d,f){return Thread.toHex(a)+Thread.toHex(d)+Thread.toHex(f)};
Thread.toHex=function(a){if(null==a)return"00";a=parseInt(a);if(0==a||isNaN(a))return"00";a=Math.max(0,a);a=Math.min(a,255);a=Math.round(a);return"0123456789ABCDEF".charAt((a-a%16)/16)+"0123456789ABCDEF".charAt(a%16)};
Thread.domToBB=function(a,d){for(var f="",b,c,g,e,h=0;h<a.childNodes.length;h++)if(b=a.childNodes[h],e=g=c="","undefined"==typeof b.tagName)switch(b.nodeName){case "#text":f+=b.data.replace(/[\n\t]+/,"")}else{switch(b.tagName){case "SPAN":switch(!0){case "underline"==b.style.textDecoration:c="[u]";e="[/u]";break;case 0<b.style.fontWeight:case "bold"==b.style.fontWeight:c="[b]";e="[/b]";break;case "italic"==b.style.fontStyle:c="[i]";e="[/i]";break;case ""!=b.style.fontFamily:c="[font\x3d"+b.style.fontFamily+
"]";e="[/font]";break;case ""!=b.style.fontSize:c="[size\x3d"+b.style.fontSize+"]";e="[/size]";break;case ""!=b.style.color:-1!=b.style.color.indexOf("rgb")?(c=b.style.color.replace("rgb(","").replace(")","").split(","),c="#"+Thread.RGBtoHex(parseInt(c[0]),parseInt(c[1]),parseInt(c[2]))):c=b.style.color,c="[color\x3d"+c+"]",e="[/color]"}break;case "STRONG":case "B":c="[b]";e="[/b]";break;case "EM":case "I":c="[i]";e="[/i]";break;case "U":c="[u]";e="[/u]";break;case "IMG":d[b.src.split("/").pop()]?
(c="",g=d[b.src.split("/").pop()],e=""):(c="[img]",g=b.src,e="[/img]");break;case "A":switch(!0){case 0==b.href.indexOf("mailto:"):c="[email\x3d"+b.href.replace("mailto:","")+"]";e="[/email]";break;default:c="[url\x3d"+b.href+"]",e="[/url]"}break;case "OL":c="[list\x3d"+b.type+"]";e="\n[/list]";break;case "UL":c="[list]";e="\n[/list]";break;case "LI":c="\n[*]";e="";break;case "BLOCKQUOTE":b.removeChild(b.firstChild);c="[quote]\n";e="\n[/quote]";break;case "DIV":b.style.textAlign&&(c="["+b.style.textAlign+
"]\n",e="\n[/"+b.style.textAlign+"]\n");switch(b.className){case "codeblock":c="[code]\n";e="\n[/code]";b.removeChild(b.getElementsByTagName("div")[0]);break;case "codeblock phpcodeblock":g=b.getElementsByTagName("code")[0],b.removeChild(b.getElementsByTagName("div")[0]),c="[php]\n",g=g.innerText?g.innerText:g.innerHTML.replace(/<br([^>]*)>/gi,"\n").replace(/<([^<]+)>/gi,"").replace(/&nbsp;/gi," "),e="\n[/php]"}break;case "P":e="\n\n";break;case "BR":e="\n"}f+=c+g;""==g&&b.childNodes&&0<b.childNodes.length&&
(f+=Thread.domToBB(b,d));f+=e}return f};
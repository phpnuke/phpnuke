(function($){$.extend(mejs.MepDefaults,{default_poster:'',loopText:'Repeat On/Off',shuffleText:'Shuffle On/Off',nextText:'Next Track',prevText:'Previous Track',playlistText:'Show/Hide Playlist'});$.extend(MediaElementPlayer.prototype,{buildloop:function(player,controls,layers,media){var t=this;var loop=$('<div class="mejs-button mejs-loop-button '+((player.options.loop)?'mejs-loop-on':'mejs-loop-off')+'">'+'<button type="button" aria-controls="'+player.id+'" title="'+player.options.loopText+'"></button>'+'</div>').appendTo(controls).click(function(e){player.options.loop=!player.options.loop;$(media).trigger('mep-looptoggle',[player.options.loop]);if(player.options.loop){loop.removeClass('mejs-loop-off').addClass('mejs-loop-on')}
else{loop.removeClass('mejs-loop-on').addClass('mejs-loop-off')}});t.loopToggle=t.controls.find('.mejs-loop-button')},loopToggleClick:function(){var t=this;t.loopToggle.trigger('click')},buildshuffle:function(player,controls,layers,media){var t=this;var shuffle=$('<div class="mejs-button mejs-shuffle-button '+((player.options.shuffle)?'mejs-shuffle-on':'mejs-shuffle-off')+'">'+'<button type="button" aria-controls="'+player.id+'" title="'+player.options.shuffleText+'"></button>'+'</div>').appendTo(controls).click(function(e){player.options.shuffle=!player.options.shuffle;$(media).trigger('mep-shuffletoggle',[player.options.shuffle]);if(player.options.shuffle){shuffle.removeClass('mejs-shuffle-off').addClass('mejs-shuffle-on')}
else{shuffle.removeClass('mejs-shuffle-on').addClass('mejs-shuffle-off')}});t.shuffleToggle=t.controls.find('.mejs-shuffle-button')},shuffleToggleClick:function(){var t=this;t.shuffleToggle.trigger('click')},buildprevtrack:function(player,controls,layers,media){var t=this;var prevTrack=$('<div class="mejs-button mejs-prevtrack-button mejs-prevtrack">'+'<button type="button" aria-controls="'+player.id+'" title="'+player.options.prevText+'"></button>'+'</div>').appendTo(controls).click(function(e){$(media).trigger('mep-playprevtrack');player.playPrevTrack()});t.prevTrack=t.controls.find('.mejs-prevtrack-button')},prevTrackClick:function(){var t=this;t.prevTrack.trigger('click')},buildnexttrack:function(player,controls,layers,media){var t=this;var nextTrack=$('<div class="mejs-button mejs-nexttrack-button mejs-nexttrack">'+'<button type="button" aria-controls="'+player.id+'" title="'+player.options.nextText+'"></button>'+'</div>').appendTo(controls).click(function(e){$(media).trigger('mep-playnexttrack');player.playNextTrack()});t.nextTrack=t.controls.find('.mejs-nexttrack-button')},nextTrackClick:function(){var t=this;t.nextTrack.trigger('click')},buildplaylist:function(player,controls,layers,media){var t=this;var playlistToggle=$('<div class="mejs-button mejs-playlist-button '+((player.options.playlist)?'mejs-hide-playlist':'mejs-show-playlist')+'">'+'<button type="button" aria-controls="'+player.id+'" title="'+player.options.playlistText+'"></button>'+'</div>').appendTo(controls).click(function(e){player.options.playlist=!player.options.playlist;$(media).trigger('mep-playlisttoggle',[player.options.playlist]);if(player.options.playlist){layers.children('.mejs-playlist').show();playlistToggle.removeClass('mejs-show-playlist').addClass('mejs-hide-playlist')}
else{layers.children('.mejs-playlist').hide();playlistToggle.removeClass('mejs-hide-playlist').addClass('mejs-show-playlist')}});t.playlistToggle=t.controls.find('.mejs-playlist-button')},playlistToggleClick:function(){var t=this;t.playlistToggle.trigger('click')},buildplaylistfeature:function(player,controls,layers,media){var playlist=$('<div class="mejs-playlist mejs-layer">'+'<ul class="mejs"></ul>'+'</div>').appendTo(layers);if(!player.options.playlist){playlist.hide()}
if(player.options.default_poster!=''){playlist.css({'background-image':'url(index.php?timthumb=true&data_image=true&src='+player.options.default_poster+'&w=398&h=200)','background-repeat':'no-repeat','border':'1px solid #000'})}
if(player.options.playlistposition=='bottom'){playlist.css('top',player.options.audioHeight+'px')}
else{playlist.css('bottom',player.options.audioHeight+'px')}
var getTrackName=function(trackUrl){var trackUrlParts=trackUrl.split("/");if(trackUrlParts.length>0){return decodeURIComponent(trackUrlParts[trackUrlParts.length-1])}
else{return ''}};var tracks=[];$('#'+player.id).find('.mejs-mediaelement source').each(function(index,element){if($.trim(this.src)!=''){var track={};track.source=$.trim(this.src);if($.trim(this.title)!=''){track.name=$.trim(this.title)}
else{track.name=getTrackName(track.source)}
if($.trim($(this).attr('data-path'))!=''){track.data_path=$.trim($(this).attr('data-path'))}
else{track.data_path=''}
tracks.push(track)}});for(var track in tracks){layers.find('.mejs-playlist > ul').append('<li data-url="'+tracks[track].source+'" data-path="'+tracks[track].data_path+'" title="'+tracks[track].name+'">'+tracks[track].name+'</li>')}
layers.find('li:first').addClass('current played');layers.find('.mejs-playlist > ul li').click(function(e){if(!$(this).hasClass('current')){$(this).addClass('played');player.playTrack($(this))}
else{player.play()}
playlist.css({'background-image':'url(index.php?timthumb=true&data_image=true&src='+$(this).attr('data-path')+'&w=398&h=200)','background-repeat':'no-repeat','border':'1px solid #000'})});media.addEventListener('ended',function(e){player.playNextTrack()},!1)},playNextTrack:function(){var t=this;var tracks=t.layers.find('.mejs-playlist > ul > li');var current=tracks.filter('.current');var notplayed=tracks.not('.played');if(notplayed.length<1){current.removeClass('played').siblings().removeClass('played');notplayed=tracks.not('.current')}
if(t.options.shuffle){var random=Math.floor(Math.random()*notplayed.length);var nxt=notplayed.eq(random)}
else{var nxt=current.next();if(nxt.length<1&&t.options.loop){nxt=current.siblings().first()}}
if(nxt.length==1){nxt.addClass('played');t.playTrack(nxt)}},playPrevTrack:function(){var t=this;var tracks=t.layers.find('.mejs-playlist > ul > li');var current=tracks.filter('.current');var played=tracks.filter('.played').not('.current');if(played.length<1){current.removeClass('played');played=tracks.not('.current')}
if(t.options.shuffle){var random=Math.floor(Math.random()*played.length);var prev=played.eq(random)}
else{var prev=current.prev();if(prev.length<1&&t.options.loop){prev=current.siblings().last()}}
if(prev.length==1){current.removeClass('played');t.playTrack(prev)}},playTrack:function(track){var t=this;t.pause();t.setSrc(track.attr('data-url'));t.load();t.play();track.addClass('current').siblings().removeClass('current')},playTrackURL:function(url){var t=this;var tracks=t.layers.find('.mejs-playlist > ul > li');var track=tracks.filter('[data-url="'+url+'"]');t.playTrack(track)}})})(mejs.$)